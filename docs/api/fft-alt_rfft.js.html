<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>fft-alt/rfft.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-array.html">array</a><ul class='methods'><li data-type='method'><a href="module-array.html#.add">add</a></li><li data-type='method'><a href="module-array.html#.concat">concat</a></li><li data-type='method'><a href="module-array.html#.fill">fill</a></li><li data-type='method'><a href="module-array.html#.mult">mult</a></li><li data-type='method'><a href="module-array.html#.round">round</a></li><li data-type='method'><a href="module-array.html#.roundTo">roundTo</a></li><li data-type='method'><a href="module-array.html#.substr">substr</a></li><li data-type='method'><a href="module-array.html#.testAll">testAll</a></li><li data-type='method'><a href="module-array.html#.zeros">zeros</a></li></ul></li><li><a href="module-buffer.html">buffer</a><ul class='methods'><li data-type='method'><a href="module-buffer.html#~memberofmodule:buffer">memberof module:buffer</a></li></ul></li><li><a href="module-delay.html">delay</a></li><li><a href="module-dft.html">dft</a><ul class='methods'><li data-type='method'><a href="module-dft.html#.dft">dft</a></li></ul></li><li><a href="module-dsp-kit.html">dsp-kit</a></li><li><a href="module-fft-asm.html">fft-asm</a></li><li><a href="module-fftshift.html">fftshift</a><ul class='methods'><li data-type='method'><a href="module-fftshift.html#.fftshift">fftshift</a></li><li data-type='method'><a href="module-fftshift.html#.ifftshift">ifftshift</a></li></ul></li><li><a href="module-ola.html">ola</a><ul class='methods'><li data-type='method'><a href="module-ola.html#.overlapAdd">overlapAdd</a></li><li data-type='method'><a href="module-ola.html#.overlapAdd">overlapAdd</a></li></ul></li><li><a href="module-oscillator.html">oscillator</a><ul class='methods'><li data-type='method'><a href="module-oscillator.html#.oscillator">oscillator</a></li></ul></li><li><a href="module-phase-vocoder.html">phase-vocoder</a><ul class='methods'><li data-type='method'><a href="module-phase-vocoder.html#.paulStretch">paulStretch</a></li><li data-type='method'><a href="module-phase-vocoder.html#.phaseVocoder">phaseVocoder</a></li></ul></li><li><a href="module-rfft.html">rfft</a><ul class='methods'><li data-type='method'><a href="module-rfft.html#.rfft">rfft</a></li></ul></li><li><a href="module-signal.html">signal</a></li><li><a href="module-signal_arithmetic.html">signal/arithmetic</a><ul class='methods'><li data-type='method'><a href="module-signal_arithmetic.html#.abs">abs</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.add">add</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.div">div</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.mod">mod</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.mul">mul</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.pow">pow</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.round">round</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.sub">sub</a></li></ul></li><li><a href="module-signal_comparasion.html">signal/comparasion</a><ul class='methods'><li data-type='method'><a href="module-signal_comparasion.html#.eq">eq</a></li><li data-type='method'><a href="module-signal_comparasion.html#.gt">gt</a></li><li data-type='method'><a href="module-signal_comparasion.html#.gte">gte</a></li><li data-type='method'><a href="module-signal_comparasion.html#.gtp">gtp</a></li><li data-type='method'><a href="module-signal_comparasion.html#.lt">lt</a></li><li data-type='method'><a href="module-signal_comparasion.html#.lte">lte</a></li><li data-type='method'><a href="module-signal_comparasion.html#.ltp">ltp</a></li></ul></li><li><a href="module-signal_integrator.html">signal/integrator</a><ul class='methods'><li data-type='method'><a href="module-signal_integrator.html#.accum">accum</a></li><li data-type='method'><a href="module-signal_integrator.html#.phasor">phasor</a></li><li data-type='method'><a href="module-signal_integrator.html#~clamp">clamp</a></li></ul></li><li><a href="module-spectrum.html">spectrum</a><ul class='methods'><li data-type='method'><a href="module-spectrum.html#.bandFrequency">bandFrequency</a></li><li data-type='method'><a href="module-spectrum.html#.bandWidth">bandWidth</a></li><li data-type='method'><a href="module-spectrum.html#.polar">polar</a></li><li data-type='method'><a href="module-spectrum.html#.rectangular">rectangular</a></li><li data-type='method'><a href="module-spectrum.html#.unwrap">unwrap</a></li></ul></li><li><a href="module-waa.html">waa</a></li><li><a href="module-window.html">window</a></li></ul><h3>Global</h3><ul><li><a href="global.html#and">and</a></li><li><a href="global.html#cos">cos</a></li><li><a href="global.html#ola">ola</a></li><li><a href="global.html#or">or</a></li><li><a href="global.html#rfft">rfft</a></li><li><a href="global.html#val">val</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">fft-alt/rfft.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * > real split radix FFT algorithm
 *
 * RFFT is a class for calculating the Discrete Fourier Transform of a signal
 * with the Fast Fourier Transform algorithm.
 *
 * @param {Number} bufferSize The size of the sample buffer to be computed. Must be power of 2
 *
 * @constructor
 */

/**
 * Performs a forward transform on the sample buffer.
 * Converts a time domain signal to frequency domain spectra.
 *
 * @param {Array} buffer The sample buffer. Buffer Length must be power of 2
 *
 * @returns The frequency spectrum array
 */
function rfft (bufferSize) {
  trans = new Float64Array(bufferSize)
  generateReverseTable()
}


// Ordering of output:
//
// trans[0]     = re[0] (==zero frequency, purely real)
// trans[1]     = re[1]
//             ...
// trans[n/2-1] = re[n/2-1]
// trans[n/2]   = re[n/2]    (==nyquist frequency, purely real)
//
// trans[n/2+1] = im[n/2-1]
// trans[n/2+2] = im[n/2-2]
//             ...
// trans[n-1]   = im[1]

RFFT.prototype.forward = function (buffer) {
  var n         = bufferSize,
      spectrum  = spectrum,
      x         = trans,
      TWO_PI    = 2*Math.PI,
      sqrt      = Math.sqrt,
      i         = n >>> 1,
      bSi       = 2 / n,
      n2, n4, n8, nn,
      t1, t2, t3, t4,
      i1, i2, i3, i4, i5, i6, i7, i8,
      st1, cc1, ss1, cc3, ss3,
      e,
      a,
      rval, ival, mag

  reverseBinPermute(x, buffer)

  /*
  var reverseTable = reverseTable

  for (var k = 0, len = reverseTable.length; k &lt; len; k++) {
    x[k] = buffer[reverseTable[k]]
  }
  */

  for (var ix = 0, id = 4; ix &lt; n; id *= 4) {
    for (var i0 = ix; i0 &lt; n; i0 += id) {
      // sumdiff(x[i0], x[i0+1]); // {a, b}  &lt;--| {a+b, a-b}
      st1 = x[i0] - x[i0 + 1]
      x[i0] += x[i0 + 1]
      x[i0 + 1] = st1
    }
    ix = 2 * (id - 1)
  }

  n2 = 2
  nn = n >>> 1

  while((nn = nn >>> 1)) {
    ix = 0
    n2 = n2 &lt;&lt; 1
    id = n2 &lt;&lt; 1
    n4 = n2 >>> 2
    n8 = n2 >>> 3
    do {
      if(n4 !== 1) {
        for(i0 = ix; i0 &lt; n; i0 += id) {
          i1 = i0
          i2 = i1 + n4
          i3 = i2 + n4
          i4 = i3 + n4

          //diffsum3_r(x[i3], x[i4], t1); // {a, b, s} &lt;--| {a, b-a, a+b}
          t1 = x[i3] + x[i4]
          x[i4] -= x[i3]
          //sumdiff3(x[i1], t1, x[i3]);   // {a, b, d} &lt;--| {a+b, b, a-b}
          x[i3] = x[i1] - t1
          x[i1] += t1

          i1 += n8
          i2 += n8
          i3 += n8
          i4 += n8

          //sumdiff(x[i3], x[i4], t1, t2); // {s, d}  &lt;--| {a+b, a-b}
          t1 = x[i3] + x[i4]
          t2 = x[i3] - x[i4]

          t1 = -t1 * Math.SQRT1_2
          t2 *= Math.SQRT1_2

          // sumdiff(t1, x[i2], x[i4], x[i3]); // {s, d}  &lt;--| {a+b, a-b}
          st1 = x[i2]
          x[i4] = t1 + st1
          x[i3] = t1 - st1

          //sumdiff3(x[i1], t2, x[i2]); // {a, b, d} &lt;--| {a+b, b, a-b}
          x[i2] = x[i1] - t2
          x[i1] += t2
        }
      } else {
        for(i0 = ix; i0 &lt; n; i0 += id) {
          i1 = i0
          i2 = i1 + n4
          i3 = i2 + n4
          i4 = i3 + n4

          //diffsum3_r(x[i3], x[i4], t1); // {a, b, s} &lt;--| {a, b-a, a+b}
          t1 = x[i3] + x[i4]
          x[i4] -= x[i3]

          //sumdiff3(x[i1], t1, x[i3]);   // {a, b, d} &lt;--| {a+b, b, a-b}
          x[i3] = x[i1] - t1
          x[i1] += t1
        }
      }

      ix = (id &lt;&lt; 1) - n2
      id = id &lt;&lt; 2
    } while (ix &lt; n)

    e = TWO_PI / n2

    for (var j = 1; j &lt; n8; j++) {
      a = j * e
      ss1 = Math.sin(a)
      cc1 = Math.cos(a)

      // ss3 = sin(3*a); cc3 = cos(3*a)
      cc3 = 4 * cc1 * (cc1 * cc1 - 0.75)
      ss3 = 4 * ss1 * (0.75 - ss1 * ss1)

      ix = 0; id = n2 &lt;&lt; 1
      do {
        for (i0 = ix; i0 &lt; n; i0 += id) {
          i1 = i0 + j
          i2 = i1 + n4
          i3 = i2 + n4
          i4 = i3 + n4

          i5 = i0 + n4 - j
          i6 = i5 + n4
          i7 = i6 + n4
          i8 = i7 + n4

          // cmult(c, s, x, y, &amp;u, &amp;v)
          // cmult(cc1, ss1, x[i7], x[i3], t2, t1); // {u,v} &lt;--| {x*c-y*s, x*s+y*c}
          t2 = x[i7] * cc1 - x[i3] * ss1
          t1 = x[i7] * ss1 + x[i3] * cc1

          // cmult(cc3, ss3, x[i8], x[i4], t4, t3)
          t4 = x[i8] * cc3 - x[i4] * ss3
          t3 = x[i8] * ss3 + x[i4] * cc3

          // sumdiff(t2, t4);   // {a, b} &lt;--| {a+b, a-b}
          st1 = t2 - t4
          t2 += t4
          t4 = st1

          // sumdiff(t2, x[i6], x[i8], x[i3]); // {s, d}  &lt;--| {a+b, a-b}
          // st1 = x[i6]; x[i8] = t2 + st1; x[i3] = t2 - st1
          x[i8] = t2 + x[i6]
          x[i3] = t2 - x[i6]

          // sumdiff_r(t1, t3); // {a, b} &lt;--| {a+b, b-a}
          st1 = t3 - t1
          t1 += t3
          t3 = st1

          // sumdiff(t3, x[i2], x[i4], x[i7]); // {s, d}  &lt;--| {a+b, a-b}
          // st1 = x[i2]; x[i4] = t3 + st1; x[i7] = t3 - st1
          x[i4] = t3 + x[i2]
          x[i7] = t3 - x[i2]

          // sumdiff3(x[i1], t1, x[i6]);   // {a, b, d} &lt;--| {a+b, b, a-b}
          x[i6] = x[i1] - t1
          x[i1] += t1

          // diffsum3_r(t4, x[i5], x[i2]); // {a, b, s} &lt;--| {a, b-a, a+b}
          x[i2] = t4 + x[i5]
          x[i5] -= t4
        }

        ix = (id &lt;&lt; 1) - n2
        id = id &lt;&lt; 2

      } while (ix &lt; n)
    }
  }

  while (--i) {
    rval = x[i]
    ival = x[n - i - 1]
    mag = bSi * sqrt(rval * rval + ival * ival)

    spectrum[i] = mag
  }

  spectrum[0] = bSi * x[0]

  return spectrum
}

// lookup tables don't really gain us any speed, but they do increase
// cache footprint, so don't use them in here
// the rest was translated from C, see http://www.jjj.de/fxt/
// is the real split radix FFT
function reverseBinPermute (dest, source) {
  var bufferSize = bufferSize
  var halfSize = bufferSize >>> 1
  var nm1 = bufferSize - 1
  var i = 1
  var r = 0
  var h

  dest[0] = source[0]

  do {
    r += halfSize
    dest[i] = source[r]
    dest[r] = source[i]

    i++

    h = halfSize &lt;&lt; 1
    while (h = h >> 1, !((r ^= h) &amp; h))

    if (r >= i) {
      dest[i] = source[r]
      dest[r] = source[i]

      dest[nm1 - i] = source[nm1 - r]
      dest[nm1 - r] = source[nm1 - i]
    }
    i++
  } while (i &lt; halfSize)
  dest[nm1] = source[nm1]
}

function generateReverseTable (bufferSize) {
  var reverseTable = new Uint32Array(bufferSize)
  var halfSize = bufferSize >>> 1
  var nm1 = bufferSize - 1
  var i = 1
  var r = 0
  var h

  reverseTable[0] = 0

  do {
    r += halfSize

    reverseTable[i] = r
    reverseTable[r] = i

    i++

    h = halfSize &lt;&lt; 1
    while (h = h >> 1, !((r ^= h) &amp; h))

    if (r >= i) {
      reverseTable[i] = r
      reverseTable[r] = i

      reverseTable[nm1 - i] = nm1 - r
      reverseTable[nm1 - r] = nm1 - i
    }
    i++
  } while (i &lt; halfSize)

  reverseTable[nm1] = nm1
}

module.exports = RFFT
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Thu Feb 02 2017 10:55:40 GMT+0100 (CET)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
