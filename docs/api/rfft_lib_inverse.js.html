<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rfft/lib/inverse.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-array.html">array</a><ul class='methods'><li data-type='method'><a href="module-array.html#.add">add</a></li><li data-type='method'><a href="module-array.html#.concat">concat</a></li><li data-type='method'><a href="module-array.html#.fill">fill</a></li><li data-type='method'><a href="module-array.html#.mult">mult</a></li><li data-type='method'><a href="module-array.html#.round">round</a></li><li data-type='method'><a href="module-array.html#.substr">substr</a></li><li data-type='method'><a href="module-array.html#.testAll">testAll</a></li><li data-type='method'><a href="module-array.html#.zeros">zeros</a></li></ul></li><li><a href="module-delay.html">delay</a></li><li><a href="module-dft.html">dft</a><ul class='methods'><li data-type='method'><a href="module-dft.html#.dft">dft</a></li><li data-type='method'><a href="module-dft.html#.idft">idft</a></li></ul></li><li><a href="module-dsp-kit.html">dsp-kit</a></li><li><a href="module-fft.html">fft</a><ul class='methods'><li data-type='method'><a href="module-fft.html#.ifft">ifft</a></li></ul></li><li><a href="module-fftshift.html">fftshift</a><ul class='methods'><li data-type='method'><a href="module-fftshift.html#.fftshift">fftshift</a></li><li data-type='method'><a href="module-fftshift.html#.ifftshift">ifftshift</a></li></ul></li><li><a href="module-ola.html">ola</a><ul class='methods'><li data-type='method'><a href="module-ola.html#.overlapAdd">overlapAdd</a></li><li data-type='method'><a href="module-ola.html#.overlapAdd">overlapAdd</a></li></ul></li><li><a href="module-oscillator.html">oscillator</a><ul class='methods'><li data-type='method'><a href="module-oscillator.html#.oscillator">oscillator</a></li></ul></li><li><a href="module-phase-vocoder.html">phase-vocoder</a><ul class='methods'><li data-type='method'><a href="module-phase-vocoder.html#.paulStretch">paulStretch</a></li><li data-type='method'><a href="module-phase-vocoder.html#.phaseVocoder">phaseVocoder</a></li></ul></li><li><a href="module-rfft.html">rfft</a><ul class='methods'><li data-type='method'><a href="module-rfft.html#.rfft">rfft</a></li></ul></li><li><a href="module-signal.html">signal</a></li><li><a href="module-signal_arithmetic.html">signal/arithmetic</a><ul class='methods'><li data-type='method'><a href="module-signal_arithmetic.html#.abs">abs</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.add">add</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.div">div</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.mod">mod</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.mul">mul</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.pow">pow</a></li><li data-type='method'><a href="module-signal_arithmetic.html#.sub">sub</a></li></ul></li><li><a href="module-signal_comparasion.html">signal/comparasion</a></li><li><a href="module-signal_integrator.html">signal/integrator</a><ul class='methods'><li data-type='method'><a href="module-signal_integrator.html#.accum">accum</a></li></ul></li><li><a href="module-spectrum.html">spectrum</a><ul class='methods'><li data-type='method'><a href="module-spectrum.html#.bandFrequency">bandFrequency</a></li><li data-type='method'><a href="module-spectrum.html#.bandWidth">bandWidth</a></li><li data-type='method'><a href="module-spectrum.html#.polar">polar</a></li><li data-type='method'><a href="module-spectrum.html#.rectangular">rectangular</a></li><li data-type='method'><a href="module-spectrum.html#.unwrap">unwrap</a></li></ul></li><li><a href="module-waa.html">waa</a></li><li><a href="module-window.html">window</a></li></ul><h3>Global</h3><ul><li><a href="global.html#cos">cos</a></li><li><a href="global.html#ola">ola</a></li><li><a href="global.html#rfft">rfft</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">rfft/lib/inverse.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable one-var */
// input must have ordering as in output of the forward version,
// you can just pass in this.trans and it should work (if you've scaled it)

/**
 * Perform inverse FFT using a real split radix FFT algorithm
 *
 * Code from @Spudd86 (https://github.com/corbanbrook/dsp.js/pull/5)
 */
export default function inverse (bufferSize, buffer, output) {
  var n = bufferSize
  var x = output || new Float64Array(bufferSize)
  var TWO_PI = 2 * Math.PI
  var n2, n4, n8, nn,
    t1, t2, t3, t4, t5,
    j, i0, i1, i2, i3, i4, i5, i6, i7, i8, ix, id,
    st1, cc1, ss1, cc3, ss3,
    e, a

  x.set(buffer)

  nn = n >>> 1
  n2 = n &lt;&lt; 1

  while ((nn >>>= 1)) {
    ix = 0
    id = n2
    n2 >>>= 1
    n4 = n2 >>> 2
    n8 = n4 >>> 1

    do { // ix
      for (i0 = ix; i0 &lt; n; i0 += id) {
        i1 = i0
        i2 = i1 + n4
        i3 = i2 + n4
        i4 = i3 + n4

        // sumdiff3(x[i1], x[i3], t1);// {a, b, d} &lt;--| {a+b, b, a-b}
        t1 = x[i1] - x[i3]; x[i1] += x[i3]

        x[i2] += x[i2]
        x[i4] += x[i4]

        // sumdiff3_r(x[i4], t1, x[i3]);// {a,b,d} &lt;--| {a+b, b, b-a}
        x[i3] = t1 - x[i4]; x[i4] += t1

        if (n4 !== 1) {  // note: optimise (Note this comment from original C++)
          i1 += n8
          i2 += n8
          i3 += n8
          i4 += n8

          // sumdiff3(x[i1], x[i2], t1); // {a, b, d} &lt;--| {a+b, b, a-b}
          t1 = x[i1] - x[i2]; x[i1] += x[i2]

          // sumdiff(a, b, &amp;s, &amp;d) {s, d}  &lt;--| {a+b, a-b}
          // sumdiff(x[i4], x[i3], t2, x[i2])
          t2 = x[i4] + x[i3]; x[i2] = x[i4] - x[i3]

          t2 = -t2 * Math.SQRT2
          t1 *= Math.SQRT2
          // sumdiff(a, b, &amp;s, &amp;d) {s, d}  &lt;--| {a+b, a-b}
          // sumdiff(t2, t1, x[i3], x[i4])
          x[i3] = t2 + t1; x[i4] = t2 - t1
        }
      }

      ix = (id &lt;&lt; 1) - n2
      id &lt;&lt;= 2
    } while (ix &lt; n)

    e = TWO_PI / n2
    for (j = 1; j &lt; n8; j++) {
      a = j * e

      ss1 = Math.sin(a)
      cc1 = Math.cos(a)

      // ss3 = sin(3 * a); cc3 = cos(3 * a)
      cc3 = 4 * cc1 * (cc1 * cc1 - 0.75)
      ss3 = 4 * ss1 * (0.75 - ss1 * ss1)

      ix = 0
      id = n2 &lt;&lt; 1
      do { // ix-loop
        for (i0 = ix; i0 &lt; n; i0 += id) {
          i1 = i0 + j
          i2 = i1 + n4
          i3 = i2 + n4
          i4 = i3 + n4

          i5 = i0 + n4 - j
          i6 = i5 + n4
          i7 = i6 + n4
          i8 = i7 + n4

          // sumdiff3(x[i1], x[i6], t1); // {a, b, d} &lt;--| {a+b, b, a-b}
          t1 = x[i1] - x[i6]; x[i1] += x[i6]
          // sumdiff3(x[i5], x[i2], t2); // {a, b, d} &lt;--| {a+b, b, a-b}
          t2 = x[i5] - x[i2]; x[i5] += x[i2]
          // t2 = x[i5] + x[i2]; x[i5] = x[i5] - x[i2]

          // sumdiff(a, b, &amp;s, &amp;d) {s, d}  &lt;--| {a+b, a-b}
          // sumdiff(x[i8], x[i3], t3, x[i6])
          // sumdiff(x[i4], x[i7], t4, x[i2])
          t3 = x[i8] + x[i3]; x[i6] = x[i8] - x[i3]
          t4 = x[i4] + x[i7]; x[i2] = x[i4] - x[i7]

          // sumdiff3(t1, t4, t5); // {a, b, d} &lt;--| {a+b, b, a-b}
          t5 = t1 - t4; t1 += t4
          // sumdiff3(t2, t3, t4); // {a, b, d} &lt;--| {a+b, b, a-b}
          t4 = t2 - t3; t2 += t3

          // cmult(c, s, x, y, &amp;u, &amp;v) {u,v} &lt;--| {x*c-y*s, x*s+y*c}
          // cmult(ss1, cc1, t5, t4, x[i7], x[i3])
          // cmult(cc3, ss3, t1, t2, x[i4], x[i8])
          x[i7] = t5 * ss1 - t4 * cc1; x[i3] = t5 * cc1 + t4 * ss1
          x[i4] = t1 * cc3 - t2 * ss3; x[i8] = t1 * ss3 + t2 * cc3
        }

        ix = (id &lt;&lt; 1) - n2
        id &lt;&lt;= 2
      } while (ix &lt; n)
    }
  }

  for (ix = 0, id = 4; ix &lt; n; id *= 4) {
    for (i0 = ix; i0 &lt; n; i0 += id) {
      //  sumdiff(&amp;a, &amp;b) {a, b}  &lt;--| {a+b, a-b}
      // sumdiff(x[i0], x[i0+1])
      st1 = x[i0] - x[i0 + 1]
      x[i0] += x[i0 + 1]
      x[i0 + 1] = st1
    }
    ix = 2 * (id - 1)
  }

  reverseBinPermuteInPlace(bufferSize, x)
  return x
}

// don't use a lookup table to do the permute, use this instead
// the inverse transform needs to do this in place so we have this
function reverseBinPermuteInPlace (bufferSize, buf) {
  var halfSize = bufferSize >>> 1
  var nm1 = bufferSize - 1
  var i = 1, r = 0, h, t

  do {
    r += halfSize
    t = buf[i]
    buf[i] = buf[r]
    buf[r] = t

    i++

    h = halfSize &lt;&lt; 1
    while (h = h >> 1, !((r ^= h) &amp; h)) ;

    if (r >= i) {
      t = buf[i]
      buf[i] = buf[r]
      buf[r] = t
      t = buf[nm1 - i]
      buf[nm1 - i] = buf[nm1 - r]
      buf[nm1 - r] = t
    }
    i++
  } while (i &lt; halfSize)
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Sat Jan 21 2017 20:24:08 GMT+0100 (CET)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
